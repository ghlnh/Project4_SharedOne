<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.sharedOne.mapper.order.YdsOrderMapper">
	<select id="searchBuyer" resultType="com.sharedOne.domain.master.BuyerDto">
		SELECT 
			buyerCode,
			buyerName,
			address,
			country,
			businessNumber,
			phone,
			deliveryCompany,
			manager
		FROM Buyer
		<where>
		<trim prefixOverrides="OR" prefix="OR">
			<if test="buyerName != null">
				OR buyerName Like #{buyerInfo}
			</if>
			<if test="buyerCode !=null">
				OR buyerCode LIKE #{buyerInfo}
			</if>
			<if test="address !=null">
				OR address Like #{buyerInfo}
			</if>
			<if test="country !=null">
				OR country LIKE #{buyerInfo}
			</if>
			<if test="manager !=null">
				OR manager LIKE #{buyerInfo}
			</if>
		</trim>
		</where>
		
	</select>
		<select id="getBuyerNames" resultType="com.sharedOne.domain.master.BuyerDto">
		SELECT 
			buyerName
		FROM Buyer
	</select>
	
	<select id="searchProduct" resultType="com.sharedOne.domain.master.ProductDto">
		SELECT 
			p.productCode,
			p.productType,
			p.productName,
			p.weight,
			p.size,
			p.price,
			p.unit,
			s.salePrice,
			s.buyerCode
		FROM
			Product p 
		LEFT JOIN SalePrice s ON p.productCode = s.productCode
		WHERE
			<trim prefixOverrides="OR">
				<if test="#{productInfo} != null">
					OR p.productCode Like #{productInfo}
				</if>
				<if test="#{productInfo} != null">
					OR p.productName Like #{productInfo}
				</if>
				<if test="#{productInfo} != null">
					OR p.productType Like #{productInfo}
				</if>
			</trim>
	</select>
	
	<select id="addTempProductOrder" resultType="com.sharedOne.domain.master.YdsProductDto">
		SELECT
		 	productCode,
		 	productName,
		 	productType,
		 	size,
		 	unit,
		 	price
		 FROM Product 
		 where productCode = #{productCode}
		 
	</select>
	<insert id="insertOrderHeader">
	INSERT INTO Order_header(
		deliveryDate,
		buyerCode,
		status,
		message
	)
	VALUES(#{deliveryDate}, #{buyerCode}, '승인요청', #{message})
	
	</insert>
	
	<insert id="insertOrderItem">
	INSERT INTO Order_item(
		productCode,
		quantity,
		salePrice
	)
	VALUES(#{productCode}, #{quantity}, #{salePrice})
	
	</insert>
	


</mapper>